# Модуль 18: "Создание переиспользуемых бандлов для Symfony" - Домашняя работа

## Правильная работа над проектом

Задание должно быть выполнено на отдельной ветке. После выполнения задания запуште эту ветку и создайте Merge Request. В рамках этого Merge Request будет осуществляться проверка домашней работы. Как только все замечания будут устранены - вы сольете его в ветку master.

## Свой Bundle - фабрика существ

### Описание Сервиса
Сервис Фабрики существ, состоит из трех классов:
* `Unit` - существо,
* `Strategy` - стратегия производства,
* `UnitFactory` - фабрика существ.

Эти три готовых класса уже приложены к вашему домашнему заданию, но, **рекомендую** попробовать создать их самостоятельно, ниже идет более детальное описание этих классов.

#### Unit
Класс `SymfonySkillbox\HomeworkBundle\User` описывает существо, которое будет создавать фабрика.

Содержит 4-ре поля, который должны быть установлены в конструкторе
```php
public function __construct(string $name, int $cost, int $strength, int $health)
{

}
```

* `name` - наименование существа (Крестьянин, Солдат, Лучник и т.д.),
* `cost` - стоимость создания существа,
* `strength` - условная сила существа,
* `health` - кол-во здоровья.

К каждому полю должен быть создан свой отдельный метод getter

#### StrategyInterface
Интерфейс `SymfonySkillbox\HomeworkBundle\StrategyInterface` описывает интерфейс - стратегии производства существ. Стратегия определяет какое существо должно быть создано фабрикой следующим, при указании доступного объема ресурсов.

Содержит один публичный метод `next`,
```php
/**
 * @param Unit[] $units
 * @param int $resource
 * @return Unit|null
 */
public function next(array $units, int $resource): ?Unit;
```

* `units` - массив доступных на фабрике существ,
* `resource` - доступно ресурсов.

#### UnitFactory
Сервис реализующий создание армии юнитов.

По умолчанию позволяет создавать армию из `Крестьянина`, `Солдата` и `Лучника`.

Содержит три свойства, инициализируемые конструктором
```php
public function __construct(StrategyInterface $strategy, bool $enableSolder, bool $enableArcher)
```

* `strategy` - стратегия создания юнитов,
* `enableSolder` - доступны ли для создания солдаты,
* `enableArcher` - доступны ли для создания лучники,


А также два метода:
##### getUnits
```php
/**
 * Формирует список доступных юнитов на фабрике
 * 
 * @return Unit[]
 */
private function getUnits()
```
Метод, в зависимости от свойств, должен возвращать набор доступных для производства юнитов.

##### produceUnits
```php
/**
 * Производит армию
 * 
 * @param int $resources
 * @return Unit[]
 */
public function produceUnits(int $resources): array
```

Метод должен произвести армию на все доступные `resource` согласно требуемой стратегии (`Strategy`)


##### базовые характеристики юнитов
Предлагаемые характеристики юнитов, удобные для тестирования:

| name       | cost | strength | health |
|------------|------|----------|--------|
| Крестьянин | 33   | 1        | 1      |
| Солдат     | 100  | 5        | 100    |
| Лучник     | 150  | 6        | 50     |


## Создание Bundle
Создайте новый Bundle `SymfonySkillbox\HomeworkBundle\SymfonySkillboxHomeworkBundle`, предоставляющий сервис, описанный выше. Разместите его в директории `/lib/HomeworkBundle/`.

### Сервисы Bundle
Bundle должен предоставлять следующие сервисы в приложение:

* `symfony_skillbox_homework.unit_factory` - сервис Фабрики юнитов,
* `symfony_skillbox_homework.strategy` - алиас стратегии,
* `symfony_skillbox_homework.strategy_strength` - стратегия производства юнитов по силе,
* `symfony_skillbox_homework.strategy_health` - стратегия производства юнитов по объему здоровья,
* `symfony_skillbox_homework.produce_unit_command` - консольная команда, для запуска фабрики создания юнитов.

### Конфигурирование Bundle
Bundle должен позволять пользователям конфигурировать следующие параметры:
```yaml
symfony_skillbox_homework:

    # Стратегия производства юнитов по умолчанию по силе (SymfonySkillbox\HomeworkBundle\StrengthStrategy)
    strategy:             null

    # Разрешено ли производство солдат
    enable_solder:        true

    # Разрешено ли производство лучников
    enable_archer:        true
```

### Подключение
Внутри bundle должен быть создан файл composer.json и в основной проект бандл должен подключаться с помощью команды:
```
composer require symfony-skillbox-homework/unit-factory-bundle:dev-master
```

Отдельный git репозиторий создавать `НЕ НУЖНО`

### Стратегии создания юнитов

#### Стратегии предоставляемые бандлом

Ваш бандл должен предоставлять две встроенные стратегии создания юнитов:

* `SymfonySkillbox\HomeworkBundle\StrengthStrategy` - по силе - всегда старается создать самого сильного юнита,
* `SymfonySkillbox\HomeworkBundle\HealthStrategy` - по здоровью - всегда старается создать самого живучего юнита.

#### Стратегии вашего приложения
В вашем приложении должны быть реализованы две стратегии создания юнитов:

* `App\Homework\ZergRushStrategy` - самые дешевые - всегда создает самого дешевого юнита,
* `App\Homework\BillGatesStrategy` - самые дорогие - всегда старается создать самого дорогого юнита.


### Консольная команда
Bundle должен предоставлять консольную команду `symfony-skillbox-homework:produce-units`, готовую к использованию сразу после его установки. 
Для этого команду нужно сконфигурировать как сервис [с особым тегом](https://symfony.com/doc/current/console/commands_as_services.html)

```
php bin/console symfony-skillbox-homework:produce-units 593
```

Результат работы команду нужно отобразить в следующем виде
```
на 593 было куплено 5 юнитов
 ------------ ------ ------ ---------- 
  Имя          Цена   Сила   Здоровье  
 ------------ ------ ------ ---------- 
  Лучник       150    6      50        
  Лучник       150    6      50        
  Лучник       150    6      50        
  Солдат       100    5      100       
  Крестьянин   33     1      1         
 ------------ ------ ------ ---------- 

Осталось ресурсов: 10
```

## *Задание со звездочкой

### Расширяемые Юниты
С использованием системы [тегированных сервисов](https://symfony.com/doc/current/service_container/tags.html), сделайте так, чтобы фабрику можно было расширить новыми существами. 

#### Провайдер юнитов
Создайте базовый Интерфейс `SymfonySkillbox\HomeworkBundle\UnitProviderInterface`

Этот интерфейс должен предоставлять один метод, который возвращает список юнитов:
```php
/**
 * @return Unit[]
 */
public function getUnits(): array;
```

Создайте базовую реализацию этого интерфейса `SymfonySkillbox\HomeworkBundle\BaseUnitProvider`, предоставляющую возможность создавать базовые юниты, описанные выше.

Уберите возможность конфигурирования опций `enable_solder`, `enable_archer` вместо них используйте коллекцию с `UnitProviderInterface` классами.

Конструктор класса `UnitFactory` теперь должен выглядеть примерно так:
```php
/**
 * @param StrategyInterface $strategy
 * @param UnitProviderInterface[] $unitProviders
 */
public function __construct(StrategyInterface $strategy, iterable $unitProviders)
```

#### Провайдеры
Для добавления провайдеров с юнитами должен быть настроен тег `symfony_skillbox_homework.unit_provider`

В случае, если ни один провайдер не установлен, то должен использоваться провайдер с базовым набором юнитов.

Создайте в вашем приложении новый-ые провайдер-ы, и сконфигурируйте их подключение к фабрике юнитов.